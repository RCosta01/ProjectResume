sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","../../model/formatter/pdp","sap/ui/core/routing/History","sap/ui/core/SeparatorItem","sap/m/ColumnListItem","sap/m/Input","sap/m/DatePicker","sap/base/util/deepExtend","sap/m/Select","sap/ui/core/Item","sap/m/Button","sap/m/GroupHeaderListItem","sap/m/Token","sap/m/Text","sap/m/MessageBox"],function(e,t,s,i,a,o,r,n,u,l,d,g,c,p,b,m,h){"use strict";return e.extend("projects.controller.pdp.MgrPlanPage",{formatter:i,onInit:function(){var e=this.getOwnerComponent().getRouter();this.oTable=this.getView().byId("objTable");this.oReadOnlyTemplate=this.getView().byId("objTable").getBindingInfo("items").template;var t=this;var s=t.getOwnerComponent().getModel("i18n").getResourceBundle();this._i18n=s;jQuery.sap.includeStyleSheet(sap.ui.require.toUrl("projects/css/pdp.css"));this.oEditableTemplate=new r({cells:[new n({value:"{objTab>cust_objectiveName}",editable:{path:"objTab>cust_objLibraryId",formatter:i.editableEdit}}),new n({value:"{objTab>cust_objectiveDesc}",editable:{path:"objTab>cust_objLibraryId",formatter:i.editableEdit}}),new d({items:{path:"initiativeList>/",template:new g({key:"{initiativeList>externalCode}",text:"{initiativeList>description}"})},editable:{path:"objTab>cust_objLibraryId",formatter:i.editableEdit},selectedKey:"{objTab>cust_initiativeType}"}),new m({text:{parts:[{path:"objTab>cust_createdByManager"},{path:"i18n>creatorMgrTextMgr"},{path:"i18n>creatorMgrTextEmp"}],formatter:i.formatCreator}}),new m({text:{parts:[{path:"objTab>cust_objLibraryId"},{path:"i18n>creatorMgrTextNew"},{path:"i18n>creatorMgrTextLib"}],formatter:i.formatIniType}}),new u({id:"editDatePicker",value:{path:"objTab>cust_objectiveRealDate",formatter:i.formatDate},valueFormat:"dd/MM/yyyy",displayFormat:"long"}),new n({value:"{objTab>cust_objectiveObs}"}),new d({items:{path:"objStatusList>/",template:new sap.ui.core.Item({key:"{objStatusList>externalCode}",text:"{objStatusList>description}"})},selectedKey:"{objTab>cust_objectiveStatus}"}),new c({press:[this.onDelete,this],icon:"sap-icon://sys-cancel",tooltip:s.getText("removeObjText")})]});e.getRoute("RouteMgrPlanPage").attachMatched(this._matchedObject,this)},_matchedObject:function(e){var s={data:"sap-icon://person-placeholder"};this.getView().setModel(new t(s),"picDetails");this.setObjectivesModel(s[0].data);this.setCurrentPlanModel(that.getOwnerComponent().getModel("routingInfo").getData().status);this.setMobilityPlanModel(s[1].data);this.setPlanDetails(that.getOwnerComponent().getModel("routingInfo").getData().cname);this.setPrevPlan(that.getOwnerComponent().getModel("routingInfo").getData().pdps)},setObjectivesModel(e){var s=this;var i=[{cust_objectiveName:"Formação Excel",cust_objectiveDesc:"Realizar Formação E-Learning sobre Excel",cust_createdByManager:true,cust_objLibraryId:123,cust_objectiveRealDate:new Date("2025","09","03"),cust_objectiveObs:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam in.",cust_objectiveStatus:"1"}];var a=new t(e.results);s.getView().setModel(a,"objTab");var o=s.getView().byId("objTable").getItems();o.forEach(function(e,t){if(e.cust_objectiveStatus==="4"){e.addStyleClass("cross")}});s.setCustomCss()},setCurrentPlanModel(e){switch(e){case"1":var s={status:"1",editDate:new Date("2025","07","01"),strongPoints:"",improvements:"",cust_empCreationDate:new Date("2025","07","01")};break;case"2":var s={status:"2",editDate:new Date("2025","07","01"),strongPoints:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras dapibus urna quis dui laoreet cursus. Cras sed turpis quis ipsum mollis gravida ac in dolor. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nullam sollicitudin mi quis lorem facilisis gravida. Proin at quam volutpat, malesuada est eu, tincidunt lacus. Cras congue quam sed fringilla viverra. Fusce.",improvements:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod velit, nec porta magna. Duis ornare felis nec condimentum.",cust_empCreationDate:new Date("2025","07","01")};case"3":var s={status:"3",editDate:new Date("2025","07","01"),strongPoints:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras dapibus urna quis dui laoreet cursus. Cras sed turpis quis ipsum mollis gravida ac in dolor. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nullam sollicitudin mi quis lorem facilisis gravida. Proin at quam volutpat, malesuada est eu, tincidunt lacus. Cras congue quam sed fringilla viverra. Fusce.",improvements:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla et euismod velit, nec porta magna. Duis ornare felis nec condimentum.",cust_empCreationDate:new Date("2025","07","01")};default:var s={};break}var i=new t(s);this.getView().setModel(i,"currentPlan")},setPlanDetails(e){var s=this;var i=e.split(" ");var a=this.getOwnerComponent().getModel("pdpConfigData").getData().find(e=>e.cust_pdpId===this._pId);i=i[0]+" "+i[i.length-1];var o=new t({uName:i,pName:a.cust_pdpName,cust_pdpMaxObj:a.cust_pdpMaxObj,cust_pdpMinObj:a.cust_pdpMinObj});s.getView().setModel(o,"details");if(s.getOwnerComponent().getModel("device").oData.system.phone){s.byId("addLibButtonMobile").bindProperty("visible",{path:"currentPlan>/status",formatter:s.formatter.formatVisibilityButtons});s.byId("addCustButtonMobile").bindProperty("visible",{path:"currentPlan>/status",formatter:s.formatter.formatVisibilityButtons})}else{s.byId("addLibButton").bindProperty("visible",{path:"currentPlan>/status",formatter:s.formatter.formatVisibilityButtons});s.byId("addCustButton").bindProperty("visible",{path:"currentPlan>/status",formatter:s.formatter.formatVisibilityButtons})}},setMobilityPlanModel(e){var s=this;if(e.results.length>0){var i=new t(e.results[0]);s.getView().setModel(i,"mobilityTab");if(e.results[0].cust_mobAnswer===null){var a={noAnswerViewState:true,answerViewState:false,answerEditState:false}}else{var a={noAnswerViewState:false,answerViewState:true,answerEditState:false}}}else{var a={noAnswerViewState:true,answerViewState:false,answerEditState:false}}s.setMobilityModel(a)},setMobilityModel(e){var s=new t(e);this.getView().setModel(s,"mobilityModel")},setCustomCss:function(){var e=this.getView().byId("objTable").getBinding("items").oList;var t=this.getView().byId("objTable").getItems();for(var s=0;s<e.length;s++){if(e[s].cust_objectiveStatus==="4"){t[s].addStyleClass("greyBackground");for(var i=0;i<t[s].getAggregation("cells").length;i++){t[s].getAggregation("cells")[i].addStyleClass("cross")}}else{t[s].removeStyleClass("greyBackground");for(var i=0;i<t[s].getAggregation("cells").length;i++){t[s].getAggregation("cells")[i].removeStyleClass("cross")}}}},setPhoto:function(e){var s={data:"data:"+e.mimeType+";base64,"+e.photo};var i=new t(s);this.getView().setModel(i,"picDetails")},rebindTable:function(e){this.oTable.bindItems({path:"objTab>/",template:e,templateShareable:true});if(e===this.oReadOnlyTemplate){this.setCustomCss()}},onEdit:function(){this.aObjectives=l([],this.getView().getModel("objTab").oData);this.cPlan=l([],this.getView().getModel("currentPlan").oData);if(this.getOwnerComponent().getModel("device").oData.system.phone){this.byId("importOldButtonMobile").setVisible(false);this.byId("addLibButtonMobile").setVisible(false);this.byId("addCustButtonMobile").setVisible(false)}else{this.byId("importOldButton").setVisible(false);this.byId("addLibButton").setVisible(false);this.byId("addCustButton").setVisible(false)}this.byId("objTabHelp").setVisible(false);this.byId("objTabEditHelp").setVisible(true);this.byId("submitButton").setVisible(false);this.byId("editButton").setVisible(false);this.byId("saveButton").setVisible(true);this.byId("cancelButton").setVisible(true);this.byId("textArImp").setVisible(true);this.byId("textImp").setVisible(false);this.byId("textArStrP").setVisible(true);this.byId("textStrP").setVisible(false);this.rebindTable(this.oEditableTemplate)},onCancel:function(){if(this.getOwnerComponent().getModel("device").oData.system.phone){if(this._oPId!==undefined){this.byId("importOldButtonMobile").setVisible(true)}this.byId("addLibButtonMobile").setVisible(true);this.byId("addCustButtonMobile").setVisible(true)}else{if(this._oPId!==undefined){this.byId("importOldButton").setVisible(true)}this.byId("addLibButton").setVisible(true);this.byId("addCustButton").setVisible(true)}this.byId("objTabHelp").setVisible(true);this.byId("objTabEditHelp").setVisible(false);if(this.getView().getModel("currentPlan").oData.status==="1"){this.byId("submitButton").setVisible(true)}this.byId("editButton").setVisible(true);this.byId("cancelButton").setVisible(false);this.byId("saveButton").setVisible(false);this.byId("textArImp").setVisible(false);this.byId("textImp").setVisible(true);this.byId("textArStrP").setVisible(false);this.byId("textStrP").setVisible(true);this.getView().getModel().resetChanges({groupId:"group1"});this.getView().getModel().mDeferredRequests={};this.getView().getModel("objTab").setData(this.aObjectives);this.getView().getModel("currentPlan").setData(this.cPlan);this.rebindTable(this.oReadOnlyTemplate)},onSave:async function(){var e=this.getView().getModel("currentPlan").oData;var t=this.getView().getModel();var s=this;var i=0;for(var a=0;a<this.getView().getModel("objTab").oData.length;a++){if(this.getView().getModel("objTab").oData[a].cust_objectiveStatus!=="4"){i++}}if(i>this.getView().getModel("details").oData.cust_pdpMaxObj){h.error(this._i18n.getText("extraInitiatives",[this.getView().getModel("details").oData.cust_pdpMaxObj]));return}if(e.status==="3"&&i<this.getView().getModel("details").oData.cust_pdpMinObj){h.error(this._i18n.getText("notEnoughInitiativesSave",[this.getView().getModel("details").oData.cust_pdpMinObj]),{onClose:function(){s.onCancel()}});return}this.byId("mgrPlan").setBusy(true);if(this.getOwnerComponent().getModel("device").oData.system.phone){if(this._oPId!==undefined&&e.status===1){this.byId("importOldButtonMobile").setVisible(true)}this.byId("addLibButtonMobile").setVisible(true);this.byId("addCustButtonMobile").setVisible(true)}else{if(this._oPId!==undefined&&e.status===1){this.byId("importOldButton").setVisible(true)}this.byId("addLibButton").setVisible(true);this.byId("addCustButton").setVisible(true)}this.byId("editButton").setVisible(true);var o=l([],this.getView().getModel("objTab").oData);for(var a=0;a<o.length;a++){for(var r=0;r<this.aObjectives.length;r++){if(o[a].cust_objectiveId===this.aObjectives[r].cust_objectiveId){if(o[a].cust_objectiveObs!==this.aObjectives[r].cust_objectiveObs||o[a].cust_initiativeType!==this.aObjectives[r].cust_initiativeType||o[a].cust_objectiveDesc!==this.aObjectives[r].cust_objectiveDesc||o[a].cust_objectiveName!==this.aObjectives[r].cust_objectiveName||o[a].cust_objectiveStatus!==this.aObjectives[r].cust_objectiveStatus||this.aObjectives[r].cust_objectiveRealDate.getDate()!==this.byId("objTable").getItems()[a].getAggregation("cells")[5].getDateValue().getDate()||this.aObjectives[r].cust_objectiveRealDate.getMonth()!==this.byId("objTable").getItems()[a].getAggregation("cells")[5].getDateValue().getMonth()||this.aObjectives[r].cust_objectiveRealDate.getFullYear()!==this.byId("objTable").getItems()[a].getAggregation("cells")[5].getDateValue().getFullYear()){var n="/cust_pdpObjectives(cust_objectiveId='"+o[a].cust_objectiveId+"')";var u={cust_pdpEmployees_cust_empId:o[a].cust_pdpEmployees_cust_empId,cust_objectiveStatus:o[a].cust_objectiveStatus,cust_initiativeType:o[a].cust_initiativeType,cust_objectiveObs:o[a].cust_objectiveObs,cust_objectiveRealDate:new Date(this.byId("objTable").getItems()[a].getAggregation("cells")[5].getDateValue()),cust_objectiveDesc:o[a].cust_objectiveDesc,cust_objectiveName:o[a].cust_objectiveName};this.getView().getModel("objTab").oData[a].cust_objectiveRealDate=new Date(this.byId("objTable").getItems()[a].getAggregation("cells")[5].getDateValue());t.update(n,u,{groupId:"group1",urlParameters:{operation:"updateTeamPDPObjCritical"}})}break}}}if(e.improvements!==this.cPlan.improvements||e.strongPoints!==this.cPlan.strongPoints){var d="/cust_pdpEmployees(cust_empId='"+this._uId+"',cust_pdpConfig_cust_pdpId='"+this._pId+"')";var g={cust_empId:this._uId,cust_empStrengths:this.getView().getModel("currentPlan").oData.strongPoints,cust_empImprovements:this.getView().getModel("currentPlan").oData.improvements};t.update(d,g,{urlParameters:{operation:"updateMgrPlanPhaseCritical"},groupId:"group1"})}if(e.status==="3"&&t.hasPendingChanges({groupId:"group1"})){var c={cust_empChangedDate:new Date};var n="/cust_pdpNotif('"+this._uId+this._pId+"')";t.update(n,c,{urlParameters:{operation:"updateMgrPlanPhaseCritical"},groupId:"group1"})}this.getView().getModel().submitChanges({groupId:"group1",success:function(){var e=s.getOwnerComponent().getModel("i18n").getResourceBundle();h.success(e.getText("iniEditSuccess"));s.byId("mgrPlan").setBusy(false)},error:function(e){var t=s.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(e.message+t.getText("statusCode")+e.statusCode+" "+e.responseText);s.byId("mgrPlan").setBusy(false)}});this.byId("objTabHelp").setVisible(true);this.byId("objTabEditHelp").setVisible(false);this.getView().getModel("objTab").refresh();if(e.status==="1"){this.byId("submitButton").setVisible(true)}this.byId("cancelButton").setVisible(false);this.byId("saveButton").setVisible(false);this.byId("textArImp").setVisible(false);this.byId("textImp").setVisible(true);this.byId("textArStrP").setVisible(false);this.byId("textStrP").setVisible(true);this.rebindTable(this.oReadOnlyTemplate)},onNavBack:function(){if(this.getView().byId("objTable").getBindingInfo("items").template===this.oEditableTemplate){this.onCancel()}var e=a.getInstance();var t=e.getPreviousHash();if(t!==undefined){window.history.go(-1)}else{var s=sap.ui.core.UIComponent.getRouterFor(this);this.byId("mgrPlan").setBusy(true);s.navTo("Routehomepage",true)}},onNewLibObj:function(){this._flag=0;this._fragmentId="libObj";if(!this._libObj){this._libObj=sap.ui.xmlfragment("mgr.fragment.ColabLibObj",this);this.getView().addDependent(this._libObj)}this._libObj.setModel(this.getView().getModel());this._libObj.setModel(this.getView().getModel("initiativeList"),"initiativeList");sap.ui.getCore().byId("idDatePickerColabLib").setValue();sap.ui.getCore().byId("multiInputColab").removeAllTokens();sap.ui.getCore().byId("ColabLibObs").setValue();this._libObj.open()},onExitLibObj:function(){this._libObj.close()},onCreateLibObj:function(){var e=this;var t=0;var s=this.getView().getModel();var i=sap.ui.getCore().byId("multiInputColab").getTokens();var a=sap.ui.getCore().byId("idDatePickerColabLib").getDateValue();if(i.length===0||a===null){var o=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(o.getText("missingFields"));this.byId("mgrPlan").setBusy(false);return}this.byId("mgrPlan").setBusy(true);var e=this;var r=0;for(var n=0;n<this.getView().getModel("objTab").oData.length;n++){if(this.getView().getModel("objTab").oData[n].cust_objectiveStatus!=="4"){r++}}if(parseInt(this.getView().getModel("details").oData.cust_pdpMaxObj)>=r+i.length){if(this._flag===0){this._flag=1;for(var u=0;u<i.length;u++){var l=this.getView().getModel("objTab").oData;for(var n=0;n<l.length;n++){if(l[n].cust_objLibraryId===i[u].getProperty("key")){var o=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(o.getText("repeatedObj"));return}}s.read("/cust_pdpLibrary",{urlParameters:{$filter:"cust_objLibraryId eq '"+i[u].getProperty("key")+"'",operation:"getPDPLibrary"},success:function(i){var o={cust_pdpEmployees_cust_empId:e._uId,cust_pdpConfig_cust_pdpId:e._pId,cust_objectiveName:i.results[0].cust_objName,cust_objectiveDesc:i.results[0].cust_objDesc,cust_objectiveObs:sap.ui.getCore().byId("ColabLibObs").getValue(),cust_objectiveStatus:"1",cust_initiativeType:i.results[0].cust_initiativeType,cust_objectiveType:"1",cust_objectiveRealDate:a,cust_createdByManager:true,cust_objLibraryId:i.results[0].cust_objLibraryId};s.create("/cust_pdpObjectives",o,{urlParameters:{operation:"createMgrLibObjCritical"},success(i){var a={cust_empId:e._uId,cust_pdpConfig_cust_pdpId:e._pId,cust_empChangedDate:new Date};var o="/cust_pdpEmployees(cust_empId='"+e._uId+"',cust_pdpConfig_cust_pdpId='"+e._pId+"')";s.update(o,a,{urlParameters:{operation:"updateMgrPlanPhaseCritical"},groupId:"group1"});s.submitChanges({groupId:"group1"});e.getView().getModel("objTab").oData.push(i);e.getView().getModel("objTab").refresh();e.setCustomCss();if(t===0){t=1;e.byId("mgrPlan").setBusy(false);var r=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.success(r.getText("initiativeLoaded"))}},error:function(t){var s=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(t.message+s.getText("statusCode")+t.statusCode+" "+t.responseText);e.byId("mgrPlan").setBusy(false)}})},error:function(t){var s=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(t.message+s.getText("statusCode")+t.statusCode+" "+t.responseText);e.byId("mgrPlan").setBusy(false)}})}e._libObj.close()}}else{this.byId("mgrPlan").setBusy(false);var o=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(o.getText("extraInitiatives",[this.getView().getModel("details").oData.cust_pdpMaxObj]))}},onLogout:function(){window.location.href="./do/logout"},getGroupHeader:function(e){return new o({text:e.key})},onPressSubmit:function(){var e=this;var t=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.confirm(t.getText("planSendConfirm"),{actions:[t.getText("buttonConfirmText"),h.Action.CANCEL],emphasizedAction:t.getText("buttonConfirmText"),styleClass:"mySubmitButton2",onClose:function(t){if(t===this.actions[0]){var i=0;for(var a=0;a<e.getView().getModel("objTab").oData.length;a++){if(e.getView().getModel("objTab").oData[a].cust_objectiveStatus!==4){i++}}if(i>=e.getView().getModel("details").oData.cust_pdpMinObj){e.byId("mgrPlan").setBusy(true);var o=[];o.push(new s("cust_empId","EQ",e._uId));o.push(new s("cust_pdpConfig_cust_pdpId","EQ",e._pId));var r=e.getView().getModel();var n=e.getView().getModel("TeamPDP").oData.data;if(e.getView().getModel("currentPlan").oData.status==="1"){var u={cust_empId:e._uId,cust_pdpConfig_cust_pdpId:e._pId,cust_empStatus:"2",cust_empEditDate:new Date};var l={externalCode:e._uId+e._pId,cust_empId:e._uId,cust_empStatus:"2",cust_pdpConfig_cust_pdpId:e._pId,cust_empEditDate:new Date};r.create("/cust_pdpNotif",l,{urlParameters:{operation:"createMgrPlanPhaseCritical"},error:function(e){var t="/cust_pdpNotif('"+l.externalCode+"')";r.update(t,l,{urlParameters:{operation:"updatePersPlanPhase"}})}});var d="/cust_pdpEmployees(cust_empId='"+e._uId+"',cust_pdpConfig_cust_pdpId='"+e._pId+"')";r.update(d,u,{groupId:"group1",urlParameters:{operation:"updateMgrPlanPhaseCritical"}});e.getView().getModel("currentPlan").oData.status="2";e.getView().getModel("currentPlan").oData.cust_empEditDate=new Date;e.getView().byId("objHeaderPlan").getBinding("number").refresh();for(var a=0;a<n.length;a++){if(n[a].pId===e._pId&&n[a].NColab===e._uId){e.getView().getModel("TeamPDP").oData.data[a].Status="2"}}}e.getView().getModel("TeamPDP").refresh();e.getView().getModel("currentPlan").refresh();e.setCustomCss();r.submitChanges({groupId:"group1",success:function(){var t=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.success(t.getText("planSubmitSuccess"));e.byId("mgrPlan").setBusy(false)},error:function(t){var s=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(t.message+s.getText("statusCode")+t.statusCode+" "+t.responseText);e.byId("mgrPlan").setBusy(false)}})}else{h.error(e._i18n.getText("notEnoughInitiatives",[e.getView().getModel("details").oData.cust_pdpMinObj]))}}}})},onCreateCustom:function(){this._flag=0;this._fragmentId="custObj";if(!this._custObj){this._custObj=sap.ui.xmlfragment("mgr.fragment.ColabCustObj",this);this.getView().addDependent(this._custObj)}this._custObj.setModel(this.getView().getModel("initiativeList"),"initiativeList");sap.ui.getCore().byId("idDatePickerColabCust").setValue();sap.ui.getCore().byId("initTypSelCust").setSelectedKey();sap.ui.getCore().byId("idCustObjName").setValue();sap.ui.getCore().byId("idCustObjDesc").setValue();sap.ui.getCore().byId("idObsCustColab").setValue();this._custObj.open()},onExitCustObj:function(){this._custObj.close()},onCreateCustObj:function(){var e=this;var t=sap.ui.getCore().byId("idDatePickerColabCust").getDateValue();if(t===null||sap.ui.getCore().byId("idCustObjName").getValue()===""||sap.ui.getCore().byId("idCustObjDesc").getValue()===""){var s=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(s.getText("missingFields"));this.byId("mgrPlan").setBusy(false);return}var i=0;for(var a=0;a<this.getView().getModel("objTab").oData.length;a++){if(this.getView().getModel("objTab").oData[a].cust_objectiveStatus!=="4"){i++}}if(parseInt(this.getView().getModel("details").oData.cust_pdpMaxObj)>=i+1){if(this._flag===0){this._flag=1;var o=0;var r=this.getView().getModel();var n=sap.ui.getCore().byId("initTypSelCust").getSelectedKey();this.byId("mgrPlan").setBusy(true);var e=this;var u={cust_pdpEmployees_cust_empId:this._uId,cust_pdpConfig_cust_pdpId:this._pId,cust_objectiveName:sap.ui.getCore().byId("idCustObjName").getValue(),cust_objectiveDesc:sap.ui.getCore().byId("idCustObjDesc").getValue(),cust_objectiveObs:sap.ui.getCore().byId("idObsCustColab").getValue(),cust_objectiveStatus:"1",cust_initiativeType:n,cust_objectiveType:"2",cust_objectiveRealDate:t,cust_createdByManager:true};this._flag=1;r.create("/cust_pdpObjectives",u,{urlParameters:{operation:"createMgrLibObjCritical"},success(t){var s={cust_empId:e._uId,cust_pdpConfig_cust_pdpId:e._pId,cust_empChangedDate:new Date};var i="/cust_pdpEmployees(cust_empId='"+e._uId+"',cust_pdpConfig_cust_pdpId='"+e._pId+"')";r.update(i,s,{urlParameters:{operation:"updateMgrPlanPhaseCritical"},groupId:"group1"});r.submitChanges({groupId:"group1"});e.getView().getModel("objTab").oData.push(t);e.getView().getModel("objTab").refresh();e.setCustomCss();if(o===0){o=1;var a=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.success(a.getText("iniSaveSuccess"));e.byId("mgrPlan").setBusy(false)}},error:function(t){var s=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(t.message+s.getText("statusCode")+t.statusCode+" "+t.responseText);e.byId("mgrPlan").setBusy(false)}});this._custObj.close()}}else{var s=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(s.getText("extraInitiatives",[this.getView().getModel("details").oData.cust_pdpMaxObj]));this.byId("mgrPlan").setBusy(false)}},onDelete:function(e){this.byId("mgrPlan").setBusy(true);var t=this;this._context=e.getSource().oPropagatedProperties.oBindingContexts.objTab.sPath.split("/")[1];var s=t.getOwnerComponent().getModel("i18n").getResourceBundle();h.confirm(s.getText("iniDelConfirm"),{actions:[s.getText("buttonConfirmYes"),s.getText("buttonConfirmNo")],emphasizedAction:s.getText("buttonConfirmYes"),styleClass:"mySubmitButton2",onClose:function(e){if(e===this.actions[0]){var s=l({},t.getView().getModel("objTab").oData[t._context]);var i="/cust_pdpObjectives(cust_objectiveId='"+s.cust_objectiveId+"')";var a=t.getView().getModel("objTab").oData;for(var o=0;o<a.length;o++){a[o].cust_objectiveRealDate=new Date(t.byId("objTable").getItems()[o].getAggregation("cells")[5].getDateValue())}a.splice(t._context,1);t.getView().getModel("objTab").refresh();t.getView().getModel().remove(i,{urlParameters:{operation:"removeMgrObjCritical"},groupId:"group1"});t.byId("mgrPlan").setBusy(false)}else{t.byId("mgrPlan").setBusy(false)}}})},onPullPlan:function(){var e=this;var t=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.confirm(t.getText("planPullConfirm"),{actions:[t.getText("buttonConfirmText"),h.Action.CANCEL],emphasizedAction:t.getText("buttonConfirmText"),styleClass:"mySubmitButton2",onClose:function(t){if(t===this.actions[0]){e.byId("mgrPlan").setBusy(true);var s=e.getView().getModel();var i={cust_empId:e._uId,cust_pdpConfig_cust_pdpId:e._pId,cust_empStatus:"3",cust_empFinalDate:new Date};var a={cust_empFinalDate:new Date};var o="/cust_pdpNotif('"+e._uId+e._pId+"')";s.update(o,a,{groupId:"group1",urlParameters:{operation:"updateMgrPlanPhaseCritical"}});o="/cust_pdpEmployees(cust_empId='"+e._uId+"',cust_pdpConfig_cust_pdpId='"+e._pId+"')";s.update(o,i,{groupId:"group1",urlParameters:{operation:"updateMgrPlanPhaseCritical"}});e.getView().getModel("currentPlan").oData.status="3";e.getView().getModel("currentPlan").oData.editDate=new Date;e.getView().byId("objHeaderPlan").getBinding("number").refresh();var r=e.getView().getModel("TeamPDP").oData.data;for(var n=0;n<r.length;n++){if(r[n].pId===e._pId&&r[n].NColab===e._uId){e.getView().getModel("TeamPDP").oData.data[n].Status="3"}}e.getView().getModel("TeamPDP").refresh();e.getView().getModel("currentPlan").refresh();e.setCustomCss();s.submitChanges({groupId:"group1",success:function(){var t=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.success(t.getText("planPullSuccess"));e.byId("mgrPlan").setBusy(false)},error:function(t){var s=e.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(t.message+s.getText("statusCode")+t.statusCode+" "+t.responseText);e.byId("mgrPlan").setBusy(false)}})}}})},handleValueHelp:function(){var e=this.getView();if(!this._pValueHelpDialog){this._pValueHelpDialog=sap.ui.xmlfragment("mgr.fragment.ValueHelp",this);e.addDependent(this._pValueHelpDialog)}var t=this.getView().getModel("objTab").oData;if(t.length>0){var i=[];for(var a=0;a<t.length;a++){if(t[a].cust_objLibraryId!==null&&t[a].cust_objLibraryId!==undefined){i.push(new s("cust_objLibraryId","NE",t[a].cust_objLibraryId))}}if(i.length>0){var o=new s({filters:i,and:true});sap.ui.getCore().byId("libObjSearch").getBinding("items").filter([o]);this._filters=[o]}else{sap.ui.getCore().byId("libObjSearch").getBinding("items").filter(i);this._filters=i}}this._pValueHelpDialog.open()},getGroupHeader:function(e){var t=this.getView().getModel("initiativeList");for(var s=0;s<t.getData().length;s++){if(t.getData()[s].externalCode===e.key){var i=t.getData()[s].description}}return new p({title:i,upperCase:false})},_handleValueHelpSearch:function(e){var t=e.getParameter("value");var i=l([],this._filters);i.push(new s("cust_objName",sap.ui.model.FilterOperator.Contains,t));var a=[];a.push(new s({filters:i,and:true}));e.getSource().getBinding("items").filter(i)},_handleValueHelpClose:function(e){var t=e.getParameter("selectedItems"),s=sap.ui.getCore().byId("multiInputColab");s.removeAllTokens();e.getSource()._aSelectedItems=[];if(t&&t.length>0){t.forEach(function(e){s.addToken(new b({text:e.getTitle(),key:e.getAggregation("customData")[0].getKey()}))})}},setPrevPlan:function(e){this._oPId="123";var s={oPId:"123"};var i=new t(s);this.getView().setModel(i,"oldPlan");this.byId("mgrPlan").setBusy(false);if(this.getOwnerComponent().getModel("device").oData.system.phone){this.byId("importOldButtonMobile").bindProperty("visible",{parts:[{path:"oldPlan>/oPId"},{path:"currentPlan>/status"}],formatter:this.formatter.formatVisImpOld})}else{this.byId("importOldButton").bindProperty("visible",{parts:[{path:"oldPlan>/oPId"},{path:"currentPlan>/status"}],formatter:this.formatter.formatVisImpOld})}return},onPressImportOld:function(){this._flag=0;this._fragmentId="impOld";if(!this._impOld){this._impOld=sap.ui.xmlfragment("mgr.fragment.ImportOld",this);this.getView().addDependent(this._impOld)}this._impOld.setModel(this.getView().getModel());sap.ui.getCore().byId("idDatePickerOld").setValue();sap.ui.getCore().byId("multiInputOld").removeAllTokens();this._impOld.open()},onExitOld:function(){this._impOld.close()},handleValueHelpOld:function(){var e=this.getView();var i=this;if(!this._pValueHelpDialogOld){this._pValueHelpDialogOld=sap.ui.xmlfragment("mgr.fragment.OldIni",this);e.addDependent(this._pValueHelpDialogOld)}if(this.getView().getModel("oldPlanObj")===undefined){var a="cust_pdpEmployees_cust_empId eq '"+this._uId+"' and cust_pdpConfig_cust_pdpId eq '"+this._oPId+"' and cust_objectiveStatus ne '3' and cust_objectiveStatus ne '4'";this.getView().getModel().read("/cust_pdpObjectives",{urlParameters:{$filter:a,operation:"getTeamPDPObjCritical"},success:function(e){var a=new t(e.results);i.getView().setModel(a,"oldPlanObj");if(e.results.length!==0){var o=i.getView().getModel("objTab").oData;var r=[];for(var n=0;n<o.length;n++){if(o[n].cust_objLibraryId!==null){r.push(new s("cust_objLibraryId","NE",o[n].cust_objLibraryId))}}if(r.length>0){var u=[];u.push(new s({filters:r,and:true}));u.push(new s("cust_objLibraryId","EQ",null));var l=[];l.push(new s({filters:u,and:false}))}else{l=[]}i._filters=l;i._pValueHelpDialogOld.setModel(i.getView().getModel("oldPlanObj"),"oldPlanObj");sap.ui.getCore().byId("selDialOld").getBinding("items").filter(l);i._pValueHelpDialogOld.open()}else{var d=i.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(d.getText("noOldObjectives"))}},error:function(e){var t=i.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(e.message+t.getText("statusCode")+e.statusCode+" "+e.responseText);i.byId("empPlan").setBusy(false)}})}else{if(this.getView().getModel("oldPlanObj").oData.length!==0){var o=this.getView().getModel("objTab").oData;var r=[];for(var n=0;n<o.length;n++){if(o[n].cust_objLibraryId!==null){r.push(new s("cust_objLibraryId","NE",o[n].cust_objLibraryId))}}if(r.length>0){var u=[];u.push(new s({filters:r,and:true}));u.push(new s("cust_objLibraryId","EQ",null));var l=[];l.push(new s({filters:u,and:false}))}else{l=[]}this._filters=l;sap.ui.getCore().byId("selDialOld").getBinding("items").filter(l);this._pValueHelpDialogOld.setModel(this.getView().getModel("oldPlanObj"),"oldPlanObj");this._pValueHelpDialogOld.open()}else{var d=i.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(d.getText("noOldObjectives"))}}},_handleValueHelpSearchOld:function(e){var t=e.getParameter("value");var i=l([],this._filters);i.push(new s("cust_objectiveName",sap.ui.model.FilterOperator.Contains,t));var a=[];a.push(new s({filters:i,and:true}));e.getSource().getBinding("items").filter(i)},_handleValueHelpCloseOld:function(e){var t=e.getParameter("selectedItems"),s=sap.ui.getCore().byId("multiInputOld");s.removeAllTokens();e.getSource()._aSelectedItems=[];if(t&&t.length>0){t.forEach(function(e){s.addToken(new b({text:e.getTitle(),key:e.getAggregation("customData")[0].getKey()}))})}},_valueHelpUpdateFinished:function(){sap.ui.getCore().byId("libObjSearch").setBusy(false)},_valueHelpUpdateFinishedOld:function(){sap.ui.getCore().byId("selDialOld").setBusy(false)},onConfirmOld:function(){this.byId("mgrPlan").setBusy(true);var e=0;var t=this;var s=sap.ui.getCore().byId("multiInputOld").getTokens();var i=sap.ui.getCore().byId("idDatePickerOld").getDateValue();var a=0;for(var o=0;o<this.getView().getModel("objTab").oData.length;o++){if(this.getView().getModel("objTab").oData[o].cust_objectiveStatus!=="4"){a++}}if(parseInt(this.getView().getModel("details").oData.cust_pdpMaxObj)>=a+s.length){if(s.length===0||i===null){var r=t.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(r.getText("missingFields"));this.byId("mgrPlan").setBusy(false);return}if(this._flag===0){this._flag=1;for(var n=0;n<s.length;n++){var t=this;var u=this.getView().getModel();var l=s[n].getProperty("key");var d="cust_pdpEmployees_cust_empId eq '"+this._uId+"' and cust_pdpConfig_cust_pdpId eq '"+this._oPId+"' and cust_objectiveId eq '"+l+"'";u.read("/cust_pdpObjectives",{urlParameters:{$filter:d,operation:"getTeamPDPObjCritical"},success:function(s){var a={cust_pdpEmployees_cust_empId:t._uId,cust_pdpConfig_cust_pdpId:t._pId,cust_objectiveType:s.results[0].cust_objectiveType,cust_initiativeType:s.results[0].cust_initiativeType,cust_objectiveName:s.results[0].cust_objectiveName,cust_objectiveDesc:s.results[0].cust_objectiveDesc,cust_objectiveObs:s.results[0].cust_objectiveObs,cust_objectiveStatus:"1",cust_createdByManager:true,cust_objLibraryId:s.results[0].cust_objLibraryId,cust_objectiveRealDate:i};u.create("/cust_pdpObjectives",a,{urlParameters:{operation:"createMgrLibObjCritical"},success:function(s){var i={cust_empId:t._uId,cust_pdpConfig_cust_pdpId:t._pId,cust_empChangedDate:new Date};var a="/cust_pdpEmployees(cust_empId='"+t._uId+"',cust_pdpConfig_cust_pdpId='"+t._pId+"')";u.update(a,i,{urlParameters:{operation:"updateMgrPlanPhaseCritical"},groupId:"group1"});u.submitChanges({groupId:"group1"});t.getView().getModel("objTab").oData.push(s);t.getView().getModel("objTab").refresh();t.setCustomCss();if(e===0){e=1;var o=t.getOwnerComponent().getModel("i18n").getResourceBundle();h.success(o.getText("iniImportSuccess"));t.byId("mgrPlan").setBusy(false)}},error:function(e){var s=t.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(e.message+s.getText("statusCode")+e.statusCode+" "+e.responseText);t.byId("mgrPlan").setBusy(false)}})},error:function(e){var s=t.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(e.message+s.getText("statusCode")+e.statusCode+" "+e.responseText);t.byId("mgrPlan").setBusy(false)}})}this._impOld.close()}}else{var r=t.getOwnerComponent().getModel("i18n").getResourceBundle();h.error(r.getText("extraInitiatives",[this.getView().getModel("details").oData.cust_pdpMaxObj]));this.byId("mgrPlan").setBusy(false)}},onMCBSelChange:function(e){if(e.getParameter("selected")&&this.byId("mobilityMCB").getSelectedKeys().length>3)this.byId("mobilityMCB").removeSelectedItem(e.getParameter("changedItem"))},handleObjTabHelp:function(e){var t=e.getSource();var s=this.getOwnerComponent().getModel("i18n").getResourceBundle();if(!this._pPopover){this._pPopover=sap.ui.xmlfragment("mgr.fragment.PopoverTeamHelp",this);this.getView().addDependent(this._pPopover)}this._pPopover.getAggregation("content")[0].getAggregation("content")[0].setText(s.getText("helpMgrTab"));this._pPopover.openBy(t)},handleObjTabEditHelp:function(e){var t=e.getSource();var s=this.getOwnerComponent().getModel("i18n").getResourceBundle();if(!this._pPopover){this._pPopover=sap.ui.xmlfragment("mgr.fragment.PopoverTeamHelp",this);this.getView().addDependent(this._pPopover)}this._pPopover.getAggregation("content")[0].getAggregation("content")[0].setText(s.getText("helpMgrTabEdit"));this._pPopover.openBy(t)},onClosePopover:function(){this._pPopover.close()}})});
//# sourceMappingURL=MgrPlanPage.controller.js.map