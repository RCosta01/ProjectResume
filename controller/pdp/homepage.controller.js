sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","projects/util/formatter","sap/ui/core/SeparatorItem","sap/m/GroupHeaderListItem","sap/m/Token","sap/ui/model/FilterOperator","sap/base/util/deepExtend","sap/m/MessageBox","sap/ui/export/library","sap/ui/export/Spreadsheet","sap/ui/core/Fragment"],function(e,t,a,s,o,r,i,n,d,p,u,c,l){"use strict";const g=u.EdmType;return e.extend("projects.controller.pdp.homepage",{formatter:s,onInit:function(){jQuery.sap.includeStyleSheet(sap.ui.require.toUrl("projects/css/pdp.css"));sap.ui.getCore().applyTheme("sap_horizon");this._setTeamModel();this._setTeamPDPs();this._setSmallerModels();this._setPersonalPDPs();this._setInitiatives();this._setTeamPDPModels();this._teamPDPData=[];this._i18n=this.getOwnerComponent().getModel("i18n").getResourceBundle();this._opened=[];var e=this.getOwnerComponent().getRouter()},_setTeamModel:function(){const e=[{text:"100234 - Olivia Bennett",key:"100234",department:"Human Resources",nodes:[{text:"100239 - Liam Carter",key:"100239",department:"Human Resources"},{text:"100240 - Emma Rodriguez",key:"100240",department:"Human Resources"}]},{text:"100235 - Noah Kim",key:"100235",department:"Finance & Accounting"},{text:"100236 - Ava Thompson",key:"100236",department:"Finance & Accounting"},{text:"100237 - Elijah Singh",key:"100237",department:"Finance & Accounting"},{text:"100238 - Sophia Nguyen",key:"100238",department:"Research and Development",nodes:[{text:"100241 - James Patel",key:"100241",department:"Research and Development"},{text:"100242 - Isabella Rivera",key:"100242",department:"Research and Development"},{text:"100243 - Lucas Martin",key:"100243",department:"Research and Development"},{text:"100244 - Mia Schroeder",key:"100244",department:"Research and Development"},{text:"100245 - Ethan O'Connell",key:"100245",department:"Research and Development"}]}];this.getView().setModel(new t(e),"teamsModel");setTimeout(()=>{this.onPressSelectAll()},500)},_setTeamPDPs:function(){const e=[{Titulo:"PDP 2025",Nome:"Olivia Bennett",DatadeInicio:new Date("2025","0","01"),EndDate:new Date("2025","11","31"),Status:"1",NColab:"100234",pId:"pdp2025"},{Titulo:"PDP 2024",Nome:"Olivia Bennett",DatadeInicio:new Date("2024","0","01"),EndDate:new Date("2024","11","31"),Status:"3",NColab:"100234",pId:"pdp2024"},{Titulo:"PDP 2025",Nome:"Noah Kim",DatadeInicio:new Date("2025","0","01"),EndDate:new Date("2025","11","31"),Status:"2",NColab:"100235",pId:"pdp2025"},{Titulo:"PDP 2025",Nome:"Ava Thompson",DatadeInicio:new Date("2025","0","01"),EndDate:new Date("2025","11","31"),Status:"3",NColab:"100236",pId:"pdp2025"},{Titulo:"PDP 2025",Nome:"Elijah Singh",DatadeInicio:new Date("2025","0","01"),EndDate:new Date("2025","11","31"),Status:"3",NColab:"100237",pId:"pdp2025"},{Titulo:"PDP 2025",Nome:"Sophia Nguyen",DatadeInicio:new Date("2025","0","01"),EndDate:new Date("2025","11","31"),Status:"3",NColab:"100238",pId:"pdp2025"},{Titulo:"PDP 2025",Nome:"Liam Carter",DatadeInicio:new Date("2025","0","01"),EndDate:new Date("2025","11","31"),Status:"3",NColab:"100239",pId:"pdp2025"}];this.getView().setModel(new t(e),"TeamPDP")},_setPersonalPDPs:function(){const e=[{Titulo:"PDP 2025",Nome:"Brandon Murray",DatadeInicio:new Date("2025","0","01"),EndDate:new Date("2025","11","31"),Status:"2",NColab:"100210",pId:"pdp2025"},{Titulo:"PDP 2024",Nome:"Brandon Murray",DatadeInicio:new Date("2024","0","01"),EndDate:new Date("2024","11","31"),Status:"3",NColab:"100210",pId:"pdp2024"}];this.getView().setModel(new t(e),"PersonalPDP")},_setInitiatives:function(){const e=[{cust_objLibraryId:"896166",cust_objName:"Gestão",cust_initiativeType:"1",cust_objDesc:"GESTÃO E LIDERANÇA",mdfSystemStatus:"A",externalName:"Gestão"},{cust_objLibraryId:"896167",cust_objName:"Liderança",cust_initiativeType:"1",cust_objDesc:"GESTÃO E LIDERANÇA",mdfSystemStatus:"A",externalName:"Liderança"},{cust_objLibraryId:"896168",cust_objName:"Dados",cust_initiativeType:"1",cust_objDesc:"TÉCNICA E DIGITAL",mdfSystemStatus:"A",externalName:"Dados"},{cust_objLibraryId:"896175",cust_objName:"Cloud",cust_initiativeType:"1",cust_objDesc:"TECNOLOGIA",mdfSystemStatus:"A",externalName:"Cloud"}];this.getView().setModel(new t(e),"libraryObjectives");const a=[{externalCode:"1",description:"Campus"},{externalCode:"2",description:"Auto-desenvolvimento"},{externalCode:"3",description:"Projeto"},{externalCode:"4",description:"Outras Formações"}];this.getView().setModel(new t(a),"initiativeList")},_setTeamPDPModels:function(){const e=[{ncolab:"100234",pId:"pdp2025",cust_objectiveName:"Projeto PRR / AMI / Testbed 5G",cust_objectiveDesc:"Participação em projetos transversais ao nível da direção, permitindo ter contactos com outras realidades e conhecimentos, podendo transportar e capitalizar os mesmos para a equipa",cust_initiativeType:"2",cust_createdByManager:true,cust_objLibraryId:"",cust_objectiveRealDate:new Date("2025","11","31"),cust_objectiveObs:"",cust_objectiveStatus:1},{ncolab:"100234",pId:"pdp2025",cust_objectiveName:"Ferramentas",cust_objectiveDesc:"TRANSVERSAL",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","26"),cust_objectiveObs:"Formação em PowerBI, como meio de poder melhor gerir e controlar os projetos à sua responsabilidade e poder melhorar tb o reporting de atividade, de forma mais eficaz, e com menor esforço.",cust_objectiveStatus:1},{ncolab:"100234",pId:"pdp2025",cust_objectiveName:"Liderança",cust_objectiveDesc:"GESTÃO E LIDERANÇA",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","27"),cust_objectiveObs:"Liderar a Transformação Digital | Melhorar as softskills de gestão de equipa; Melhorar gestão da relação com stakeholders",cust_objectiveStatus:1},{ncolab:"100235",pId:"pdp2025",cust_objectiveName:"Ferramentas",cust_objectiveDesc:"TRANSVERSAL",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","26"),cust_objectiveObs:"Formação em PowerBI, como meio de poder melhor gerir e controlar os projetos à sua responsabilidade e poder melhorar tb o reporting de atividade, de forma mais eficaz, e com menor esforço.",cust_objectiveStatus:1},{ncolab:"100235",pId:"pdp2025",cust_objectiveName:"Liderança",cust_objectiveDesc:"GESTÃO E LIDERANÇA",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","27"),cust_objectiveObs:"Liderar a Transformação Digital | Melhorar as softskills de gestão de equipa; Melhorar gestão da relação com stakeholders",cust_objectiveStatus:1},{ncolab:"100235",pId:"pdp2025",cust_objectiveName:"Transformação Digital",cust_objectiveDesc:"TÉCNICA E DIGITAL",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","27"),cust_objectiveObs:"Automação Awareness | Oportunidades de melhoria ao nível da estruturação de informação de gestão de projetos, bem como automação de tarefas de menor valor",cust_objectiveStatus:1},{ncolab:"100236",pId:"pdp2025",cust_objectiveName:"Projeto PRR / AMI / Testbed 5G",cust_objectiveDesc:"Participação em projetos transversais ao nível da direção, permitindo ter contactos com outras realidades e conhecimentos, podendo transportar e capitalizar os mesmos para a equipa",cust_initiativeType:"2",cust_createdByManager:true,cust_objLibraryId:"",cust_objectiveRealDate:new Date("2025","11","31"),cust_objectiveObs:"",cust_objectiveStatus:1},{ncolab:"100236",pId:"pdp2025",cust_objectiveName:"Ferramentas",cust_objectiveDesc:"TRANSVERSAL",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","26"),cust_objectiveObs:"Formação em PowerBI, como meio de poder melhor gerir e controlar os projetos à sua responsabilidade e poder melhorar tb o reporting de atividade, de forma mais eficaz, e com menor esforço.",cust_objectiveStatus:1},{ncolab:"100236",pId:"pdp2025",cust_objectiveName:"Liderança",cust_objectiveDesc:"GESTÃO E LIDERANÇA",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","27"),cust_objectiveObs:"Liderar a Transformação Digital | Melhorar as softskills de gestão de equipa; Melhorar gestão da relação com stakeholders",cust_objectiveStatus:1},{ncolab:"100239",pId:"pdp2025",cust_objectiveName:"Projeto PRR / AMI / Testbed 5G",cust_objectiveDesc:"Participação em projetos transversais ao nível da direção, permitindo ter contactos com outras realidades e conhecimentos, podendo transportar e capitalizar os mesmos para a equipa",cust_initiativeType:"2",cust_createdByManager:true,cust_objLibraryId:"",cust_objectiveRealDate:new Date("2025","11","31"),cust_objectiveObs:"",cust_objectiveStatus:1},{ncolab:"100239",pId:"pdp2025",cust_objectiveName:"Ferramentas",cust_objectiveDesc:"TRANSVERSAL",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","26"),cust_objectiveObs:"Formação em PowerBI, como meio de poder melhor gerir e controlar os projetos à sua responsabilidade e poder melhorar tb o reporting de atividade, de forma mais eficaz, e com menor esforço.",cust_objectiveStatus:1},{ncolab:"100239",pId:"pdp2025",cust_objectiveName:"Liderança",cust_objectiveDesc:"GESTÃO E LIDERANÇA",cust_initiativeType:"1",cust_createdByManager:true,cust_objLibraryId:"123",cust_objectiveRealDate:new Date("2025","11","27"),cust_objectiveObs:"Liderar a Transformação Digital | Melhorar as softskills de gestão de equipa; Melhorar gestão da relação com stakeholders",cust_objectiveStatus:1}];this.getOwnerComponent().setModel(new t(e),"objTab")},_setSmallerModels:function(){const e=[{externalCode:"1",description:"Inicial"},{externalCode:"2",description:"Revisão"},{externalCode:"3",description:"Final"}];this.getOwnerComponent().setModel(new t(e),"statusList");const a=[{cust_pdpId:"pdp2025",cust_pdpName:"PDP 2025"},{cust_pdpId:"pdp2024",cust_pdpName:"PDP 2024"}];this.getOwnerComponent().setModel(new t(a),"pdpConfigData")},getDataIntoModels:function(e){this._uId=e;var t=this;var a=this.getView().getModel();var s="/User('"+e+"')";a.read(s,{urlParameters:{$select:"userId,empId,custom04",operation:"getSFUser"},groupId:"group1"});a.read("/cust_pdpConfig",{urlParameters:{$orderby:"cust_pdpInitialDate desc",operation:"getPersPDPConfig"},groupId:"group1"});a.submitChanges({groupId:"group1",success:function(e){var a=e.__batchResponses;t.setUserInfo(a[0].data);t.setPDPModel(a[1].data);t.updateTree(t._uId)}})},setPDPModel:function(e){var a=new t(e.results);this.getOwnerComponent().setModel(a,"pdpConfigData")},setUserInfo:function(e){var a={userId:e.userId,empId:e.empId,cname:e.custom04};var s=new t(a);this.getOwnerComponent().setModel(s,"userInfo")},onFinishPersPDPUpdate:function(){this.byId("pdp-PersPDP").setBusy(false)},setPersonalPDP:function(e){var a=this;var s="cust_empId eq '"+this._uId+"'";this.getView().getModel().read("/cust_pdpEmployees",{urlParameters:{$filter:s,operation:"getPersPDP"},success:function(s){var o=new t({data:[]});a._personalPDP=[];for(var r=0;r<s.results.length;r++){a._personalPDP.push(s.results[r]);var i={Titulo:"",DatadeInicio:"",EndDate:"",Status:s.results[r].cust_empStatus,pId:""};for(var n=0;n<e.length;n++){if(s.results[r].cust_pdpConfig_cust_pdpId===e[n].cust_pdpId){i.Titulo=e[n].cust_pdpName;i.DatadeInicio=e[n].cust_pdpInitialDate;i.EndDate=e[n].cust_pdpEndDate;i.pId=e[n].cust_pdpId;o.oData.data.push(i);break}}}a.getOwnerComponent().setModel(o,"PersonalPDP")}})},onLogout:function(){window.location.href="./do/logout"},createColumnConfig:function(){var e=[];e.push({label:"Nome do Plano",property:"pdpTitle",type:g.String});e.push({label:"Nome do Colaborador",type:g.String,property:"empName"});e.push({label:"Status do Plano",property:"planStat",type:g.String});e.push({label:"Título da Iniciativa",property:"iniTitle",type:g.String});e.push({label:"Status da Iniciativa",property:"iniStatus",type:g.String});e.push({label:"Data de realização",property:"realDate",type:g.Date});e.push({label:"Tipo de Iniciativa",property:"iniType",type:g.String});e.push({label:"Criador",property:"createdByMgr",type:g.Boolean,trueValue:"Chefia",falseValue:"Colaborador"});return e},onExport:function(){this.byId("pdp-page").setBusy(true);var e=this;var a=e.getOwnerComponent().getModel("i18n").getResourceBundle();p.confirm(a.getText("exportConfirm"),{actions:[a.getText("buttonConfirmText"),p.Action.CANCEL],emphasizedAction:a.getText("buttonConfirmText"),styleClass:"mySubmitButton2",onClose:function(a){if(a===this.actions[0]){var s=e.getView().getModel();var o=e.getView().getModel("TeamPDP").oData.data;for(var r=0;r<o.length;r++){var i="cust_pdpEmployees_cust_empId eq '"+o[r].NColab+"' and cust_pdpConfig_cust_pdpId eq '"+o[r].pId+"'";s.read("/cust_pdpObjectives",{urlParameters:{$filter:i,operation:"getMassObjectives"},groupId:"group1"})}s.submitChanges({groupId:"group1",success:function(a){var s=[];var r=a.__batchResponses;for(var i=0;i<o.length;i++){for(var n=0;n<r[i].data.results.length;n++){var d={pdpTitle:o[i].Titulo,empName:o[i].Nome,planStat:o[i].Status,iniTitle:r[i].data.results[n].cust_objectiveName,iniStatus:"",realDate:r[i].data.results[n].cust_objectiveRealDate,iniType:"",createdByMgr:r[i].data.results[n].cust_createdByManager};var p=e.getView().getModel("objStatusList");for(var u=0;u<p.getData().length;u++){if(p.getData()[u].externalCode===r[i].data.results[n].cust_objectiveStatus){d.iniStatus=p.getData()[u].description}}var l=e.getView().getModel("initiativeList");for(var u=0;u<l.getData().length;u++){if(l.getData()[u].externalCode===r[i].data.results[n].cust_initiativeType){d.iniType=l.getData()[u].description}}var g=e.getView().getModel("statusList");for(var u=0;u<g.getData().length;u++){if(g.getData()[u].externalCode===o[i].Status){d.planStat=g.getData()[u].description}}s.push(d)}}var b=new t(s);var m=e.createColumnConfig();var v={workbook:{columns:m,hierarchyLevel:"Level"},dataSource:b.getProperty("/"),fileName:"DirectReportExport.xlsx",worker:false};var _=new c(v);e.byId("pdp-page").setBusy(false);_.build().finally(function(){_.destroy()})}})}else{e.byId("pdp-page").setBusy(false)}}})},onPressSelectAll:function(){if(this.byId("pdp-myTeam").getSelectedItems().length===this.byId("pdp-myTeam").getItems().length){this.byId("pdp-myTeam").removeSelections()}else{this.byId("pdp-myTeam").selectAll()}this.onSelectEmployee()},onSelectEmployee:function(){var e=this.getView().byId("pdp-filterBar").getFilterGroupItems();e[0].getControl().setSelectedKey();e[1].getControl().setSelectedKey();e[2].getControl().setValue();var t=this.getView().byId("pdp-myTeam").getSelectedItems();var s=[];s.push(new a("NColab","EQ","a"));for(var o=0;o<t.length;o++){s.push(new a("NColab","EQ",t[o].getBindingContext("teamsModel").getProperty("key")))}this.getView().byId("pdp-chefiaTable").getBinding("items").filter(s)},startFilterBar:function(){var e=this.getOwnerComponent().getModel("i18n").getResourceBundle();var t=this.getView().byId("pdp-filterBar");t.addEventDelegate({onAfterRendering:function(e){var t=e.srcControl._oSearchButton;t.setVisible(false)}})},onFilterTable:function(){var e=this.getView().byId("pdp-filterBar").getFilterGroupItems();var t=e[2].getControl().getValue();var s=[];s.push(new a("NColab","EQ","a"));var o=this.getView().byId("pdp-myTeam").getSelectedItems();for(var r=0;r<o.length;r++){s.push(new a("NColab","EQ",o[r].getBindingContext("teamsModel").getProperty("key")))}if(t!==""){var i=t.split(" ")[0].split("/");var n=t.split(" ")[2].split("/");var d=new Date(i[2],i[1]-1,i[0]);var p=new Date(n[2],n[1]-1,n[0]);s.push(new a({filters:[new a("DatadeInicio","LE",p),new a("EndDate","GE",d)],and:true}))}if(e[1].getControl().getValue()!==""){s.push(new a("Status","EQ",e[1].getControl().getSelectedKey()))}if(e[0].getControl().getValue()!==""){s.push(new a("pId","EQ",e[0].getControl().getSelectedKey()))}this.getView().byId("pdp-chefiaTable").getBinding("items").filter(s)},onToggleOpenState:function(e){var t=e.getParameter("itemContext");var a=e.getParameter("itemIndex");var s=e.getParameter("expanded");if(s){var o=t.getPath();for(var r=0;r<this._opened.length;r++){if(o===this._opened[r]){return}}this._opened.push(o);this.byId("pdp-myTeam").getAggregation("items")[a].setBusy(true);this.fetchNewTree(o,a)}},fetchNewTree:function(e,t){var a=this;var s=e+"/directReports";this.getView().getModel().read(s,{urlParameters:{$select:"userId",operation:"getUserVO"},success:function(e){if(e.results.length===0){a.byId("pdp-myTeam").getAggregation("items")[t].setBusy(false)}var s=[];for(var o=0;o<e.results.length;o++){s.push(e.results[o].userId)}a.addToModel(s)},error:function(e){var t=a.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(e.message+t.getText("statusCode")+e.statusCode+" "+e.responseText);a.byId("pdp-page").setBusy(false)}})},addToModel:function(e){var t=this;var a=this.getView().getModel();if(e.length>0){for(var s=0;s<e.length;s++){var o="cust_empId eq '"+e[s]+"'";a.read("/cust_pdpEmployees",{urlParameters:{$filter:o,operation:"getEmployeesToModel"},groupId:"group1"})}a.submitChanges({groupId:"group1",success:function(e){var a=e.__batchResponses;var s=t.getOwnerComponent().getModel("pdpConfigData").oData;for(var o=0;o<a.length;o++){var r=a[o].data.results;t._teamPDPData.push(r);for(var i=0;i<r.length;i++){var n=0;if(t._directReports!==undefined){if(!t._directReports.includes(r[i].cust_empId)&&r[i].cust_empStatus!=="3"){n=1}}if(n===0){var d={Titulo:"",Nome:"",pId:"",NColab:"",DatadeInicio:"",EndDate:"",Status:"",cust_pdpMaxObj:"",cust_pdpMinObj:""};for(var p=0;p<s.length;p++){if(s[p].cust_pdpId===r[i].cust_pdpConfig_cust_pdpId){d.Titulo=s[p].cust_pdpName;d.Nome=r[i].cust_empName;d.pId=s[p].cust_pdpId;d.NColab=r[i].cust_empId;d.DatadeInicio=s[p].cust_pdpInitialDate;d.EndDate=s[p].cust_pdpEndDate;d.Status=r[i].cust_empStatus;d.cust_pdpMaxObj=s[p].cust_pdpMaxObj;d.cust_pdpMinObj=s[p].cust_pdpMinObj;var u=t.getView().getModel("TeamPDP");var c=u.getData();c.data.push(d);u.setData(c);t.getOwnerComponent().setModel(u,"TeamPDP");break}}}}}t.byId("pdp-chefiaTable").setBusy(false)},error:function(e){var a=t.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(e.message+a.getText("statusCode")+e.statusCode+" "+e.responseText);t.byId("pdp-page").setBusy(false)}})}},onNavEmpPlan:function(e){var a=e.getSource().getBindingContext("PersonalPDP").getPath().split("/")[2];var s=this.getView().getModel("PersonalPDP").getData().data[a];var o=this._personalPDP.find(e=>e.cust_pdpConfig_cust_pdpId===s.pId);var r=this.getOwnerComponent().getModel("pdpConfigData").getData().find(e=>e.cust_pdpId===s.pId);var i={pId:s.pId,sPDP:o,pdpConfig:r};var n=new t(i);this.getOwnerComponent().setModel(n,"routingInfo");this.getOwnerComponent().getRouter().navTo("RouteEmpPlanPage")},onOpenPlan:function(e){var a=e.getSource().getBindingContext("TeamPDP").getPath().split("/")[2];var s=this.getView().getModel("TeamPDP").getData().data[a];for(var o=0;o<this._teamPDPData.length;o++){if(this._teamPDPData[o].length>0){if(this._teamPDPData[o][0].cust_empId===s.NColab){var r=this._teamPDPData[o];break}}}var i=r.find(e=>e.cust_pdpConfig_cust_pdpId===s.pId);var n=s.Nome;var d=s.pId;var p=s.NColab;var u={pId:d,uId:p,pdps:r,sPdp:i,cname:n};var c=new t(u);this.getOwnerComponent().setModel(c,"routingInfo");for(var o=0;o<this._directReports.length;o++){if(this._directReports[o]===p){this.getOwnerComponent().getRouter().navTo("RouteMgrPlanPage",{uId:window.encodeURIComponent(p),pId:window.encodeURIComponent(d)});return}}this.getOwnerComponent().getRouter().navTo("RouteViewOnlyPlanPage")},onStartPicklist:function(e,a){var s=this;for(var o=0;o<e.length;o++){var r="/PickListV2";var i="id eq '"+e[o]+"'";this.getOwnerComponent().getModel().read(r,{groupId:"group1",urlParameters:{$filter:i,$expand:"values",operation:"getPicklist"}})}this.getOwnerComponent().getModel().submitChanges({groupId:"group1",success:function(e){var o=e.__batchResponses;for(var r=0;r<o.length;r++){var i=[];var n="label_"+sap.ui.getCore().getConfiguration().getLanguage();n=n.replace("-","_");if(o[r].data.results[0].values.results[0][n]===null||o[r].data.results[0].values.results[0][n]===undefined){n="label_defaultValue"}for(var d=0;d<o[r].data.results[0].values.results.length;d++){var p={optionId:o[r].data.results[0].values.results[d].optionId,externalCode:o[r].data.results[0].values.results[d].externalCode,description:o[r].data.results[0].values.results[d][n]};i.push(p)}var u=new t(i);u.setSizeLimit(i.length);s.getOwnerComponent().setModel(u,a[r])}}})},onOpenMassObj:function(){this._fragmentId="massObj";if(!this._massObj){this._massObj=sap.ui.xmlfragment("projects.fragment.pdp.MassCreateObj",this);this.getView().addDependent(this._massObj)}this._massObj.setModel(this.getView().getModel("TeamPDP"),"TeamPDP");this._massObj.setModel(this.getView().getModel("initiativeList"),"initiativeList");var e=new Date;var t=[];t.push(new a({filters:[new a("DatadeInicio","LE",e),new a("EndDate","GE",e),new a({filters:[new a("Status","EQ","1"),new a("Status","EQ","3")],and:false})],and:true}));sap.ui.getCore().byId("pdp-libObjColab").setSelectedItems();sap.ui.getCore().byId("pdp-idMassObjCustColabs").setSelectedItems();sap.ui.getCore().byId("pdp-multiInput").removeAllTokens();sap.ui.getCore().byId("pdp-libObjColab").setSelectedKeys();sap.ui.getCore().byId("pdp-idDatePickerAssign").setDateValue();sap.ui.getCore().byId("pdp-idMassLibObs").setValue();sap.ui.getCore().byId("pdp-chooseObjButton").setSelectedKey("lib");sap.ui.getCore().byId("pdp-idInputCObj").setValue();sap.ui.getCore().byId("pdp-idTextAreaCObj").setValue();sap.ui.getCore().byId("pdp-idMassObjCustColabs").setSelectedKeys();sap.ui.getCore().byId("pdp-idMassObjSelCust").setSelectedKey();sap.ui.getCore().byId("pdp-idDatePickerCustObjMass").setDateValue();sap.ui.getCore().byId("pdp-idObservCustObjMass").setValue();sap.ui.getCore().byId("pdp-libObjColab").getBinding("items").filter(t);sap.ui.getCore().byId("pdp-idMassObjCustColabs").getBinding("items").filter(t);sap.ui.getCore().byId("pdp-addObjectivesCust").setVisible(false);sap.ui.getCore().byId("pdp-addObjectivesLib").setVisible(true);this._massObj.open()},onChangeObj:function(e){var t=e.getSource().getSelectedKey();if(t==="lib"){sap.ui.getCore().byId("pdp-addObjectivesCust").setVisible(false);sap.ui.getCore().byId("pdp-addObjectivesLib").setVisible(true)}else{sap.ui.getCore().byId("pdp-addObjectivesLib").setVisible(false);sap.ui.getCore().byId("pdp-addObjectivesCust").setVisible(true)}},onExitMassObj:function(){this._massObj.close()},onCreateMassObj:function(){this._flag=0;this.byId("pdp-page").setBusy(true);var e=sap.ui.getCore().byId("pdp-chooseObjButton").getSelectedKey();var t=this;switch(e){case"lib":var a=sap.ui.getCore().byId("pdp-multiInput").getTokens();var s=sap.ui.getCore().byId("pdp-libObjColab").getSelectedKeys();var o=sap.ui.getCore().byId("pdp-idDatePickerAssign").getDateValue();var r=sap.ui.getCore().byId("pdp-idMassLibObs").getValue();if(a.length===0||s.length===0||o===null){var i=t.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(i.getText("missingFields"));this.byId("pdp-page").setBusy(false);return}this._flag=0;for(var n=0;n<a.length;n++){const e=1}break;case"new":var d=sap.ui.getCore().byId("pdp-idInputCObj").getValue();var u=sap.ui.getCore().byId("pdp-idTextAreaCObj").getValue();var s=sap.ui.getCore().byId("pdp-idMassObjCustColabs").getSelectedKeys();var c=sap.ui.getCore().byId("pdp-idMassObjSelCust").getSelectedKey();var o=sap.ui.getCore().byId("pdp-idDatePickerCustObjMass").getDateValue();var r=sap.ui.getCore().byId("pdp-idObservCustObjMass").getValue();if(d===""||u===""||s.length===0||o===null){var i=t.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(i.getText("missingFields"));this.byId("pdp-page").setBusy(false);return}var l=this.getView().getModel();var g=this.getView().getModel("TeamPDP").oData.data;for(var b=0;b<s.length;b++){var m=[];var v=s[b].split(" ");for(var _=0;_<g.length;_++){if(g[_].pId===v[1]&&g[_].NColab===v[0]){m.push(g[_])}}this.createMassCustObj(v,l,m,d,u,r,c,o)}break}this._massObj.close()},createMassCustObj:function(e,t,a,s,o,r,i,n){var d=this;var u="cust_pdpEmployees_cust_empId eq '"+e[0]+"' and cust_pdpConfig_cust_pdpId eq '"+e[1]+"' and cust_objectiveStatus ne '4'";t.read("/cust_pdpObjectives",{urlParameters:{$filter:u,operation:"getMassObjectives"},success:function(t){for(var u=0;u<a.length;u++){if(parseInt(a[u].cust_pdpMaxObj)>=t.results.length+1){var c={cust_pdpEmployees_cust_empId:e[0],cust_pdpConfig_cust_pdpId:e[1],cust_objectiveName:s,cust_objectiveDesc:o,cust_objectiveObs:r,cust_objectiveStatus:"1",cust_initiativeType:i,cust_objectiveType:"1",cust_objectiveRealDate:n,cust_createdByManager:true};d.getView().getModel().create("/cust_pdpObjectives",c,{urlParameters:{operation:"createMassCustObjCritical"},success:function(){if(d.byId("pdp-page").isBusy()){d.byId("pdp-page").setBusy(false);var e=d.getOwnerComponent().getModel("i18n").getResourceBundle();p.success(e.getText("addMassObjSuccess"));return}},error:function(e){var t=d.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(e.message+t.getText("statusCode")+e.statusCode+" "+e.responseText);d.byId("pdp-page").setBusy(false)}})}else{var l=d.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(l.getText("addMassObjFail"));d.byId("pdp-page").setBusy(false)}}},error:function(e){var t=d.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(e.message+t.getText("statusCode")+e.statusCode+" "+e.responseText);d.byId("pdp-page").setBusy(false)}})},createMassLibObj:function(e,t,s,o,r){var i=this;var n="cust_pdpEmployees_cust_empId eq '"+t[0]+"' and cust_pdpConfig_cust_pdpId eq '"+t[1]+"'";i.getView().getModel().read("/cust_pdpObjectives",{urlParameters:{$filter:n,operation:"getMassObjectives"},success:function(n){var d=[];d.push(new a("cust_pdpId","EQ",t[1]));var d="cust_pdpId eq '"+t[1]+"'";i.getView().getModel().read("/cust_pdpConfig",{urlParameters:{$filter:d,operation:"getPersPDPConfig"},success:function(a){if(parseInt(a.results[0].cust_pdpMaxObj)>=n.results.length+r){var d=0;for(var u=0;u<n.results.length;u++){if(n.results[u].cust_objLibraryId===e.cust_objLibraryId){d=1}}if(d===0){var c={cust_pdpEmployees_cust_empId:t[0],cust_pdpConfig_cust_pdpId:t[1],cust_objectiveName:e.cust_objName,cust_objectiveDesc:e.cust_objDesc,cust_objectiveObs:s,cust_objectiveStatus:"1",cust_initiativeType:e.cust_initiativeType,cust_objectiveType:"1",cust_objectiveRealDate:o,cust_createdByManager:true,cust_objLibraryId:e.cust_objLibraryId};i.getView().getModel().create("/cust_pdpObjectives",c,{urlParameters:{operation:"createMassCustObjCritical"},success:function(){if(i.byId("pdp-page").isBusy()){i.byId("pdp-page").setBusy(false);var e=i.getOwnerComponent().getModel("i18n").getResourceBundle();p.success(e.getText("addMassObjSuccess"));return}},error:function(e){var t=i.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(e.message+t.getText("statusCode")+e.statusCode+" "+e.responseText);i.byId("pdp-page").setBusy(false)}})}else{i.byId("pdp-page").setBusy(false)}}else{i.byId("pdp-page").setBusy(false)}},error:function(e){var t=i.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(e.message+t.getText("statusCode")+e.statusCode+" "+e.responseText);i.byId("pdp-page").setBusy(false)}})},error:function(e){var t=i.getOwnerComponent().getModel("i18n").getResourceBundle();p.error(e.message+t.getText("statusCode")+e.statusCode+" "+e.responseText);i.byId("pdp-page").setBusy(false)}})},_valueHelpUpdateFinished:function(){sap.ui.getCore().byId("pdp-libObjSearchMass").setBusy(false)},handleValueHelp:function(){var e=this.getView();if(!this._pValueHelpDialog){this._pValueHelpDialog=sap.ui.xmlfragment("projects.fragment.pdp.ValueHelpMass",this);e.addDependent(this._pValueHelpDialog)}this._pValueHelpDialog.open()},getGroupHeader:function(e){var t=this.getView().getModel("initiativeList");for(var a=0;a<t.getData().length;a++){if(t.getData()[a].externalCode===e.key){var s=t.getData()[a].description}}return new r({title:s,upperCase:false})},_handleValueHelpSearch:function(e){var t=e.getParameter("value");var s=new a("cust_objName",sap.ui.model.FilterOperator.Contains,t);e.getSource().getBinding("items").filter([s])},_handleValueHelpClose:function(e){var t=e.getParameter("selectedItems"),a=sap.ui.getCore().byId("pdp-multiInput");a.removeAllTokens();e.getSource()._aSelectedItems=[];if(t&&t.length>0){t.forEach(function(e){a.addToken(new i({text:e.getTitle(),key:e.getAggregation("customData")[0].getKey()}))})}},handleTeamHelp:function(e){var t=e.getSource();var a=this.getOwnerComponent().getModel("i18n").getResourceBundle();if(!this._pPopover){this._pPopover=sap.ui.xmlfragment("projects.fragment.pdp.PopoverTeamHelp",this);this.getView().addDependent(this._pPopover)}this._pPopover.getAggregation("content")[0].getAggregation("content")[0].setText(a.getText("helpTextTeam"));this._pPopover.openBy(t)},handleActionsHelp:function(e){var t=e.getSource();var a=this.getOwnerComponent().getModel("i18n").getResourceBundle();if(!this._pPopover){this._pPopover=sap.ui.xmlfragment("projects.fragment.pdp.PopoverTeamHelp",this);this.getView().addDependent(this._pPopover)}this._pPopover.getAggregation("content")[0].getAggregation("content")[0].setText(a.getText("helpActionsTeam"));this._pPopover.openBy(t)},onClosePopover:function(){this._pPopover.close()}})});
//# sourceMappingURL=homepage.controller.js.map